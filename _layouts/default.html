<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: 'en' }}">
<head>
  <meta charset="utf-8">
  <title>{% if page.title %}{{ page.title }} — {{ site.title }}{% else %}{{ site.title }}{% endif %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  {%- assign desc = page.description | default: site.description | strip_newlines | escape -%}
  {%- assign seo_url = page.url | absolute_url -%}
  {%- assign seo_img = page.image | default: site.og_image | default: site.profile_picture | absolute_url -%}
  {%- assign is_article = page.layout == 'post' or page.date -%}

  <!-- Basic SEO -->
  <meta name="description" content="{{ desc }}">
  <link rel="canonical" href="{{ seo_url }}">
  <meta name="author" content="{{ site.author }}">

  <!-- Keywords (optional, not critical for modern SEO) -->
  <meta name="keywords" content="blog, {{ site.author }}, {{ site.title }}, jekyll">

  <!-- Feed -->
  <link rel="alternate" type="application/rss+xml" title="{{ site.title }} RSS" href="{{ '/feed.xml' | relative_url }}"/>

  <!-- Favicon (optional) -->
  {% if site.favicon %}
    <link rel="icon" href="{{ site.favicon_location | relative_url }}">
    <link rel="shortcut icon" href="{{ site.favicon_location | relative_url }}">
  {% endif %}

  <!-- Styles -->
  <link rel="stylesheet" href="{{ '/css/main.css' | relative_url }}">

  <!-- Fonts (optional; safe to remove if你更偏好系统字体) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css?family=Inconsolata:400,700&display=swap" rel="stylesheet">

  <!-- Open Graph -->
  <meta property="og:title" content="{% if page.title %}{{ page.title }} — {{ site.title }}{% else %}{{ site.title }}{% endif %}">
  <meta property="og:description" content="{{ desc }}">
  <meta property="og:url" content="{{ seo_url }}">
  <meta property="og:type" content="{% if is_article %}article{% else %}website{% endif %}">
  {% if seo_img %}<meta property="og:image" content="{{ seo_img }}">{% endif %}
  {% if site.facebook_id %}<meta property="fb:admins" content="{{ site.facebook_id }}">{% endif %}

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary">
  {% if site.twitter_username %}<meta name="twitter:site" content="@{{ site.twitter_username }}">{% endif %}
  <meta name="twitter:title" content="{% if page.title %}{{ page.title }} — {{ site.title }}{% else %}{{ site.title }}{% endif %}">
  <meta name="twitter:description" content="{{ desc }}">
  {% if seo_img %}<meta name="twitter:image" content="{{ seo_img }}">{% endif %}

  <!-- Optional: 404 不再用 meta refresh，建议保持可读 404 页面 -->
</head>
<body>
  <!-- Skip Link for a11y -->
  <a class="skip-link" href="#main-content">Skip to content</a>

  <div class="wrapper">
    <header class="site-header">
      <div class="navbar container" role="navigation" aria-label="Primary">
        {% if site.ins_logo %}
          <a href="{{ '/' | relative_url }}" class="brand" aria-label="{{ site.title }}">
            <img id="ins-logo" src="{{ site.ins_logo | relative_url }}" alt="{{ site.title }}">
          </a>
        {% endif %}

        <a id="author-name" class="brand-title" href="{{ '/' | relative_url }}">{{ site.title }}</a>

        {% if site.nav and site.nav.size > 0 %}
          <nav class="primary-nav">
            <ul id="navlist" class="navbar-ul">
              {% for x in site.nav %}
                {% assign item_url = x.link %}
                {% assign is_current = (page.url == item_url) or (page.url == item_url | relative_url) %}
                <li class="nav-list">
                  <a
                    href="{{ item_url }}"
                    {% if x.name == "Resume" %} target="_blank" rel="noopener noreferrer"{% endif %}
                    {% if is_current %} aria-current="page" class="active"{% endif %}
                  >
                    {{ x.name }}
                  </a>
                </li>
              {% endfor %}
            </ul>
          </nav>
        {% endif %}
      </div>
      <hr>
    </header>

    <main id="main-content">
      <div class="container content{% if page.is_contact == true %} contact{% endif %}">
        {{ content }}

        {% if site.footer == true %}
          <hr>
          <footer class="site-footer">
            <p style="text-align:left; margin-bottom:10px">
              <small>
                {{ site.title }}<br>
                {{ site.institute }}<br>
                <a href="mailto:{{ site.email }}">{{ site.email }}</a>
              </small>
            </p>
            {%- comment -%}
            <p style="text-align:center; margin-bottom:10px">
              <a href="{{ site.footer_url }}" style="color: inherit"><small>{{ site.footer_text }}</small></a>
            </p>
            {%- endcomment -%}
          </footer>
        {% endif %}
      </div>
    </main>
  </div>

  {% if site.ga4_id %}
    <!-- GA4 (推荐) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ site.ga4_id }}"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', '{{ site.ga4_id }}');
    </script>
  {% endif %}
</body>
</html>
